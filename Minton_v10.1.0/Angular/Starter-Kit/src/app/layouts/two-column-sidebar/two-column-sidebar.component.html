<div class="left-side-menu">
  <div class="h-100">
    <div class="sidebar-content">
      <ngx-simplebar class="sidebar-icon-menu h-100" data-simplebar>
        <a routerLink="/" class="logo">
          <span>
            <img src="assets/images/logo-sm.png" alt="" height="28" />
          </span>
        </a>
        <nav class="nav flex-column" id="two-col-sidenav-main">
          @for (item of menuItems; track $index) {
            @if (hasSubmenu(item)) {
              <a
                class="nav-link"
                [class.active]="activeMenu == item.key"
                href="javascript:void(0);"
                [title]="item.key"
                (click)="toggleItem($event, item)"
              >
                <i [class]="item.icon"></i>
              </a>
            } @else {
              <a
                class="nav-link"
                [routerLink]="item.url"
                [title]="item.key"
                (click)="toggleItem($event, item)"
              >
                <i class="{{ item.icon }} align-middle"></i>
              </a>
            }
          }
        </nav>
      </ngx-simplebar>
      <!--- Sidemenu -->
      <div class="sidebar-main-menu">
        <app-logo-box />

        <ngx-simplebar id="two-col-menu" class="h-100">
          <div class="user-box text-center">
            <img
              src="assets/images/users/avatar-1.jpg"
              alt="user-img"
              title="Mat Helme"
              class="rounded-circle avatar-md"
            />
            <div ngbDropdown class="dropdown">
              <a
                ngbDropdownToggle
                class="text-reset dropdown-toggle h5 mt-2 mb-1 d-block"
                role="button"
                >Nik Patel</a
              >
              <div ngbDropdownMenu class="dropdown-menu user-pro-dropdown">
                <!-- item-->
                <a href="javascript:void(0);" class="dropdown-item notify-item">
                  <i class="fe-user me-1"></i>
                  <span>My Account</span>
                </a>

                <!-- item-->
                <a href="javascript:void(0);" class="dropdown-item notify-item">
                  <i class="fe-settings me-1"></i>
                  <span>Settings</span>
                </a>

                <!-- item-->
                <a href="javascript:void(0);" class="dropdown-item notify-item">
                  <i class="fe-lock me-1"></i>
                  <span>Lock Screen</span>
                </a>

                <!-- item-->
                <a href="javascript:void(0);" class="dropdown-item notify-item">
                  <i class="fe-log-out me-1"></i>
                  <span>Logout</span>
                </a>
              </div>
            </div>
            <p class="text-reset">Admin Head</p>
          </div>
          @for (item of menuItems; track $index) {
            <div
              class="twocolumn-menu-item"
              [ngClass]="{ 'd-block': isActiveMenu(item.key) }"
              [id]="item.key"
            >
              <div class="title-box">
                <h5 class="menu-title">{{ item.label }}</h5>
                <ul class="nav flex-column">
                  @if (item.children) {
                    @for (menu of item.children; track menu) {
                      @if (hasSubmenu(menu)) {
                        <ng-container
                          *ngTemplateOutlet="
                            MenuItemWithChildren;
                            context: {
                              menu: menu,
                              linkClassName: 'nav-link',
                              subMenuClassNames: 'nav-second-level',
                              itemClassName: 'nav-item',
                            }
                          "
                        >
                        </ng-container>
                      } @else {
                        <ng-container
                          *ngTemplateOutlet="
                            MenuItem;
                            context: {
                              menu: menu,
                              linkClassName: 'nav-link',
                              itemClassName: 'nav-item',
                            }
                          "
                        ></ng-container>
                      }
                    }
                  }
                </ul>
              </div>
            </div>
          }
        </ngx-simplebar>
      </div>
      <div class="clearfix"></div>
    </div>
  </div>
</div>

<div
  id="custom-backdrop"
  class="offcanvas-backdrop fade show d-none"
  (click)="hideBackdrop()"
></div>

<ng-template
  #MenuItemWithChildren
  let-menu="menu"
  let-itemClassName="itemClassName"
  let-linkClassName="linkClassName"
  let-subMenuClassNames="subMenuClassNames"
>
  <li
    [class]="itemClassName"
    [ngClass]="{ 'menuitem-active': activeMenuItems.includes(menu.key) }"
  >
    <a
      [class]="linkClassName"
      (click)="toggleMenuItems(menu, collapse)"
      [ngClass]="{ active: activeMenuItems.includes(menu.key) }"
      role="button"
      [attr.aria-expanded]="!menu.collapsed"
      aria-controls="sidebarDashboards"
      [attr.aria-controls]="menu.key"
    >
      <span> {{ menu.label }}</span>
      @if (menu.badge) {
        <span
          class="badge bg-{{ menu.badge.variant }} rounded-pill float-end"
          >{{ menu.badge.text }}</span
        >
      } @else {
        <span class="menu-arrow"></span>
      }
    </a>
    <div
      #collapse="ngbCollapse"
      [(ngbCollapse)]="menu.collapsed"
      class="collapse"
      id="sidebarDashboards"
    >
      <ul [class]="subMenuClassNames">
        @for (child of menu.children; track child) {
          @if (hasSubmenu(child)) {
            <ng-container
              *ngTemplateOutlet="
                MenuItemWithChildren;
                context: {
                  menu: child,
                  linkClassName: '',
                  itemClassName: '',
                  subMenuClassNames: '',
                }
              "
            ></ng-container>
          } @else {
            <ng-container
              *ngTemplateOutlet="MenuItem; context: { menu: child }"
            ></ng-container>
          }
        }
      </ul>
    </div>
  </li>
</ng-template>

<ng-template
  #MenuItem
  let-menu="menu"
  let-linkClassName="linkClassName"
  let-itemClassName="itemClassName"
>
  <li
    [class]="itemClassName"
    [ngClass]="{ 'menuitem-active': activeMenuItems.includes(menu.key) }"
  >
    <ng-container
      *ngTemplateOutlet="
        MenuItemLink;
        context: { menu: menu, className: linkClassName }
      "
    ></ng-container>
  </li>
</ng-template>

<ng-template #MenuItemLink let-menu="menu" let-className="className">
  <a
    [routerLink]="menu.url"
    class="side-nav-link-ref {{ className }}"
    [ngClass]="{ active: activeMenuItems.includes(menu.key) }"
    [attr.aria-controls]="menu.key"
  >
    {{ menu.label }}
  </a>
</ng-template>
